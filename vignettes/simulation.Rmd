---
title: "Simulating Age-Period-Cohort Data"
author: "Volker Schmid"
date: "16th November 2017"
output: pdf_document
vignette: >
  %\VignetteIndexEntry{Simulating Age-Period-Cohort Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache=TRUE)
library(bamp)
```

```{r age}
age=2*sqrt(seq(1,20,length=10))
age<- age-mean(age)
plot(age, type="l")
```
```{r}
period=15:1
period[8:15]<-8:15
period<-period/10
period<-period-mean(period)
plot(period, type="l")
```
```{r cohorts}
periods_per_agegroup=5
number_of_cohorts <- periods_per_agegroup*(10-1)+15
cohort<-rep(0,60)
cohort[1:10]<-10:1
cohort[41:60]<- -(1:20)/2
cohort<-cohort/20
cohort<-cohort-mean(cohort)
plot(cohort, type="l")
```
```{r}
simdata<-apc_simulate(-10, age, period, cohort, periods_per_agegroup, 1e6)
print(simdata$cases)
```

```{r bamp}
simmod <- bamp(cases = simdata$cases, population = simdata$population, age = "rw1", 
period = "rw1", cohort = "rw1", periods_per_agegroup =periods_per_agegroup)
simmod<-effects(simmod, save=TRUE)
```

```{r}
print(simmod)
check(simmod)
plot(simmod, quantiles=0.5)
```
```{r plot comparison}
effects<-effects(simmod)
par(mfrow=c(3,1))
plot(age, type="l")
lines(effects$age, col="blue")
plot(period, type="l")
lines(effects$period, col="blue")
plot(cohort, type="l")
lines(effects$cohort, col="blue")
```

